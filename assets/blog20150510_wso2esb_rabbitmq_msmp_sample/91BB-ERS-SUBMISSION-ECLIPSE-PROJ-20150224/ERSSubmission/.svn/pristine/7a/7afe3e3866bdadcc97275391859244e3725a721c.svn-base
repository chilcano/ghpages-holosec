<api xmlns="http://ws.apache.org/ns/synapse" name="ERSSubmissionQueuePublisher" context="/ers/SubmissionQueuePublisher">
   <resource methods="POST" uri-template="/{formBundleId}">
      <inSequence>
         <property name="CorrelationId" expression="get-property('transport', 'CorrelationId')" scope="default" type="STRING"></property>
         <property name="logmessage" expression="fn:concat('{&quot;label&quot;:&quot;DATA_ERSSubmission_Publsr&quot;, ', '&quot;message&quot;:&quot;starting ERSSubmissionQueuePublisher&quot;}')" scope="default" type="STRING" description="log"/>
         <DesLog level="custom">
            <SLTrace service="91BBERS-ERSSubmissionQueuePublisher" expression="get-property('logmessage')"></SLTrace>
         </DesLog>
         <log level="custom">
            <property name=" - - - - - - - - - - - - - - - - - - -" value="MSG STORED IN RABBITMQ"></property>
         </log>
         <property name="FORCE_SC_ACCEPTED" value="true" scope="axis2" type="STRING"></property>
         <property name="OUT_ONLY" value="true" scope="default" type="STRING"></property>
         <header name="Action" scope="default" value="urn:ERSSubmissionQueuePublisher"></header>
         <property name="rabbitmqMessageContentType" value="application/json" scope="default" type="STRING"></property>
         <property name="ERS_TYPE_OF_FLOW" value="FULL_SUBMISSION_TO_ADRS" scope="transport" type="STRING"></property>
		 <property name="ERS_FORM_BUNDLE_ID" expression="get-property('uri.var.formBundleId')" scope="transport" type="STRING"></property>
		 <log level="custom">
            <property name="*********************** get-property('uri.var.formBundleId')" expression="get-property('uri.var.formBundleId')"></property>
         </log>
         <property name="CorrelationId" expression="get-property('transport','CorrelationId')"></property>
         <class name="uk.gov.hmrc.uct.wso2.amqp.properties.AMQPPropertiesMediator"></class>
         <property name="Accept-Encoding" scope="transport" action="remove"></property>
         <property name="Cookie" scope="transport" action="remove"></property>
         <send description="send message to AMQP queue">
            <endpoint name="ERS_RABBITMQ_QUEUE" template="gov:/templates/ETMP_ERS_RABBITMQ_EP_TPL.xml" uri="rabbitmq:/ERSSubmissionQueuePublisher?{system.prop.uk.gov.hmrc.wso2.etmp.RABBIT_CONF}{system.prop.uk.gov.hmrc.wso2.etmp.RABBIT_SUBMITRETURN1}{system.prop.uk.gov.hmrc.wso2.etmp.RABBIT_password}{system.prop.uk.gov.hmrc.wso2.etmp.RABBIT_SUBMITRETURN2}&amp;"></endpoint>
         </send>
         <header name="CorrelationId" scope="transport" expression="get-property('CorrelationId')" description="For DesLog Mediator"></header>
         <property name="logmessage" expression="fn:concat('{&quot;label&quot;:&quot;DATA_ERSSubmission_Publsr&quot;, ', '&quot;message&quot;:&quot;publish message to queue&quot;}')" scope="default" type="STRING" description="log"/>
         <DesLog level="custom">
            <SLTrace service="91BBERS-ERSSubmissionQueuePublisher" expression="get-property('logmessage')"></SLTrace>
         </DesLog>
      </inSequence>
      <outSequence></outSequence>
      <faultSequence>
         <header name="CorrelationId" scope="transport" expression="get-property('CorrelationId')" description="For DesLog Mediator"></header>
         <property name="FORCE_SC_ACCEPTED" value="false" scope="axis2" type="STRING"></property>
         <property name="OUT_ONLY" value="false" scope="default" type="STRING"></property>
         <property name="logmessage" expression="fn:concat('{&quot;label&quot;:&quot;DATA_ERSSubmission_Publsr&quot;, ', '&quot;message&quot;:&quot;', get-property('ERROR_MESSAGE'), '&quot;, &quot;errorCode&quot;:&quot;', get-property('ERROR_CODE'), '&quot;, &quot;errorDetail&quot;:&quot;', get-property('ERROR_DETAIL'), '&quot;, &quot;errorMessage&quot;:&quot;', get-property('ERROR_EXCEPTION'), '&quot;, &quot;httpStatus&quot;:&quot;500&quot;}')" scope="default" type="STRING" description="log"/>
         <DesLog level="custom" category="ERROR">
            <SLTrace service="91BBERS-ERSSubmissionQueuePublisher" expression="get-property('logmessage')"></SLTrace>
         </DesLog>
         <sequence key="ESBAPIFaultHandler"></sequence>
      </faultSequence>
   </resource>
   <handlers>
	 <handler class="uk.gov.hmrc.wso2.runtime.handlers.DESBasicAuthenticationForAPIHandler"/>
   </handlers>    
</api>
